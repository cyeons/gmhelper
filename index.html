<script>
  const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
  const baseUrl = isLocal ? 'http://localhost:8888' : '';
  const functionUrl = `${baseUrl}/.netlify/functions/generateDoc`;

  async function generateDoc() {
    const deptDocNumber = document.getElementById('deptDocNumber').value;
    const docTitle = document.getElementById('docTitle').value;
    const docDate = document.getElementById('docDate').value;
    const content = document.getElementById('content').value;
    const attachment = document.getElementById('attachment').value;
    const attachmentCount = document.getElementById('attachmentCount').value || '1'; // 기본값 1

    if (!content) {
      document.getElementById('output').innerText = '필수 항목(본문)을 입력해주세요.';
      return;
    }

    console.log('호출 URL:', functionUrl);
    try {
      const response = await fetch(functionUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ deptDocNumber, docTitle, docDate, content, attachment, attachmentCount }),
      });
      if (!response.ok) {
        const text = await response.text();
        throw new Error(`서버 오류: ${response.status} - ${text}`);
      }
      const data = await response.json();
      document.getElementById('output').innerText = data.generatedDoc || data.error;
    } catch (error) {
      document.getElementById('output').innerText = '오류 발생: ' + error.message;
    }
  }
</script>